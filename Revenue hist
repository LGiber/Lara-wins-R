#Получаем данные, потому что, как выяснилось,
#правильно сохранить файл в формате CSV для меня все равно что гору перевернуть


library(quantmod)
getSymbols("MSFT", to = "2015-06-01")

#визулизируем распределение цен

barChart(MSFT)

#выделяем ряд скорректированных цен закрытия (Adjusted) в отдельную переменную 
prices <- as.numeric(Ad(MSFT))

#считаем распределение доходностей
ret <- diff(prices)/head(prices, -1)

#посмотрим на гистограмму доходностей
hist(ret, breaks = 25, xlab = "Daily returns", main = "Microsoft daily returns")


#делаем VaR по историческим данным
# VaR – худший из 95% лучших дней или просто квантиль-5%
VaR_1 <- quantile(ret, 0.05)
VaR_1

#5% 
#-0.02616231 

#моделируем исходное распределение, используем qnorm для нахождение
#квантиля нормального распределения
VaR_2 <- qnorm(0.05, mean = mean(ret), sd = sd(ret))
VaR_2
#[1] -0.02961968

#норм. распр. квантиль и исходное значение близки
#значит гипотеза о нормальном распредлении не самая неверная


#и НАКОНЕЦ-ТО попробуем готовый пакет performsnce analytics
library(PerformanceAnalytics)

#работаем с историческим методом, что и прописываем в функции
VaR_3 <- VaR(ret, 0.95, method = "historical")
VaR_3
#          [,1]
# VaR -0.02616231
#по красоте...

#ТЕПЕРЬ : ВИЗУАЛИЗИРУЕМ ВСЕ !!!
# отразим все три варианта VaR на графике используя симпатичные цвета
hist(ret, breaks = 25, xlab = "Daily returns", main = "Microsoft daily returns, 5% VaR")
abline(v = VaR_1, col = "aquamarine3")
abline(v = VaR_2, col = "lightcoral")
abline(v = VaR_3, col = "purple2") 

#все оказались рядом, а одну из них даже не видно
#с другой стороны есть отличающееся число,
#важно всегда обращать внимание на несколько мер риска
#полную картину отражает только гистограмма доходностей

